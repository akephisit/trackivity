<!doctype html>
<html lang="th">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
		<meta name="theme-color" content="#000000" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="default" />
		<meta name="apple-mobile-web-app-title" content="Trackivity" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="msapplication-TileColor" content="#000000" />
		<meta name="format-detection" content="telephone=no" />
		
		<!-- PWA Icons -->
		<link rel="manifest" href="/manifest.json" />
		<link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
		<link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png" />
		<link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512x512.png" />
		
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover" class="antialiased">
		<div style="display: contents">%sveltekit.body%</div>
		
		<!-- PWA Service Worker Registration -->
		<script>
			if ('serviceWorker' in navigator) {
				window.addEventListener('load', () => {
					navigator.serviceWorker.register('/sw.js')
						.then((registration) => {
							console.log('SW registered: ', registration);
							
							// Handle service worker updates
							registration.addEventListener('updatefound', () => {
								const newWorker = registration.installing;
								if (newWorker) {
									newWorker.addEventListener('statechange', () => {
										if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
											// New content is available, show refresh prompt
											if (confirm('แอปมีการอัปเดตใหม่ คุณต้องการรีเฟรชหน้าเพื่ออัปเดตหรือไม่?')) {
												window.location.reload();
											}
										}
									});
								}
							});
						})
						.catch((registrationError) => {
							console.log('SW registration failed: ', registrationError);
						});
				});
				
				// Handle PWA install prompt
				let deferredPrompt;
				window.addEventListener('beforeinstallprompt', (e) => {
					e.preventDefault();
					deferredPrompt = e;
					window.deferredPrompt = deferredPrompt;
				});
			}
			
			// Prevent zooming on iOS
			document.addEventListener('touchmove', function (event) {
				if (event.scale !== 1) { 
					event.preventDefault(); 
				}
			}, { passive: false });
			
			// Handle safe area insets for iOS
			if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
				document.documentElement.style.setProperty('--safe-area-inset-top', 'env(safe-area-inset-top)');
				document.documentElement.style.setProperty('--safe-area-inset-bottom', 'env(safe-area-inset-bottom)');
			}
		</script>
	</body>
</html>